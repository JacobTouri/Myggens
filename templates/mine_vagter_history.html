{% extends "base.html" %}

{% block title %}Tidligere vagter ‚Äì Myggen's{% endblock %}

{% block content %}
<style>
  /* ====== Periode-filter styling ====== */
  .range-grid{
    display:grid;
    grid-template-columns: 1fr 1fr auto;
    gap:12px;
    align-items:start; /* vigtig: undg√•r ‚Äúsk√¶v‚Äù baseline */
  }

  .range-field{
    display:flex;
    flex-direction:column;
    gap:6px;
  }

  /* reserverer plads s√• Fra/Til altid har samme h√∏jde */
  .range-field .helper-text{
    min-height:16px;
  }

  .range-actions{
    display:flex;
    gap:10px;
    align-items:flex-end;
    padding-bottom:16px; /* matcher helper-text h√∏jden */
  }

  @media (max-width: 720px){
    .range-grid{
      grid-template-columns: 1fr 1fr;
    }
    .range-actions{
      grid-column: 1 / -1;
      justify-content:flex-end;
    }
    .range-actions .btn{
      width:100%;
    }
  }

  .input-like{
    width:100%;
    height:44px;
    padding:10px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.10);
    background:rgba(0,0,0,0.30);
    color:var(--text);
    outline:none;
  }
  .input-like:focus{
    border-color:rgba(255,140,0,0.65);
    box-shadow:0 0 0 3px rgba(255,140,0,0.18);
  }

  input[type="date"].input-like{
    color-scheme: dark;
  }
  input[type="date"].input-like::-webkit-calendar-picker-indicator{
    opacity:0.75;
    cursor:pointer;
  }
</style>

<div class="layout-two-column">
  <!-- VENSTRE -->
  <section class="card card-soft">
    <div class="card-header">
      <div>
        <h1 style="margin:0;">Tidligere vagter</h1>
      </div>
    </div>

    <p style="margin-top:6px;">
      <a href="{{ url_for('mine_vagter') }}" class="btn btn-ghost">‚Üê Tilbage til Mine vagter</a>
    </p>

    <!-- FILTER -->
    <div class="card" style="margin-top:12px;">
      <h2 style="margin:0 0 10px 0;">V√¶lg periode</h2>

      <!-- FRA / TIL -->
      <form method="get" class="range-grid">
        <div class="range-field">
          <label for="from_date">Fra</label>
          <input class="input-like" type="date" id="from_date" name="from_date" value="{{ from_date or '' }}">
          <div class="helper-text">&nbsp;</div>
        </div>

        <div class="range-field">
          <label for="to_date">Til</label>
          <input class="input-like" type="date" id="to_date" name="to_date" value="{{ to_date or '' }}">
          <div class="helper-text">Fremtidige events vises ikke.</div>
        </div>

        <div class="range-actions">
          <button type="submit" class="btn btn-primary">Vis</button>
          <a class="btn btn-secondary" href="{{ url_for('mine_vagter_historik') }}">Nulstil</a>
        </div>
      </form>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.10);margin:14px 0;">
    </div>

    <!-- KPI -->
    <div class="card" style="margin-top:12px;">
      <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
        <div>
          <div class="helper-text">I alt i perioden</div>
          <div style="font-size:26px;font-weight:800;">
            {{ "%.2f"|format(total_hours) }} timer
          </div>
          {% if period_label %}
            <div class="helper-text">Periode: <strong>{{ period_label }}</strong></div>
          {% endif %}
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap;">
        </div>
      </div>
    </div>

    <!-- LISTE -->
    {% if not signups %}
      <div class="card" style="margin-top:12px;">
        <div class="helper-text">Ingen vagter i den valgte periode.</div>
      </div>
    {% else %}
      {% for item in signups %}
        {% set shift = item.shift %}
        {% set missing = item.work_hours is none %}
        {% set approved = item.hours_approved_by_admin %}
        {% set paid = item.payroll_paid %}
        {% set final_hours = item.approved_work_hours if approved and item.approved_work_hours is not none else item.work_hours %}

        <div class="card" style="margin-top:12px;">
          <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;">
            <div>
              <div style="font-weight:800;">{{ shift.date|dkdate }}</div>
              <div class="helper-text">
                {{ shift.location }}{% if shift.description %} ¬∑ {{ shift.description }}{% endif %}
              </div>
            </div>

            <div>
              {% if missing %}
                <span class="tag-pill" style="background:rgba(255,75,75,0.15);">Timer mangler ‚õî</span>
              {% elif paid %}
                <span class="tag-pill" style="background:rgba(58,203,106,0.15);">Afregnet ‚úÖ</span>
              {% elif approved %}
                <span class="tag-pill" style="background:rgba(58,203,106,0.10);">Godkendt ‚úîÔ∏è</span>
              {% else %}
                <span class="tag-pill" style="background:rgba(255,213,105,0.15);">Afventer üïí</span>
              {% endif %}
            </div>
          </div>

          <div style="margin-top:10px;display:flex;gap:12px;flex-wrap:wrap;">
            <div class="card" style="flex:1;background:rgba(255,255,255,0.02);">
              <div class="helper-text">Registreret</div>
              <strong>{{ item.work_start or "-" }} ‚Üí {{ item.work_end or "-" }}</strong><br>
              Timer: {{ "%.2f"|format(item.work_hours) if not missing else "‚Äî" }}
            </div>

            <div class="card" style="flex:1;background:rgba(255,255,255,0.02);">
              <div class="helper-text">Timetal</div>
              <strong>{{ "%.2f"|format(final_hours) if not missing else "‚Äî" }} timer</strong>
            </div>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </section>

  <!-- H√òJRE -->
  <aside class="hero-panel">
    <div class="hero-bg-rotator"></div>
    <div class="hero-panel-inner">
      <div>
        <div class="hero-heading">Statusforklaring</div>
        <p class="hero-text">
          <strong>Afventer</strong>: registreret, ikke godkendt.<br>
          <strong>Godkendt</strong>: l√•st til l√∏n.<br>
          <strong>Afregnet</strong>: Sendt afsted til l√∏n.
        </p>
      </div>
    </div>
  </aside>
</div>
{% endblock %}
