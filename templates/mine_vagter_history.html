{% extends "base.html" %}

{% block title %}Tidligere vagter ‚Äì Myggen's{% endblock %}

{% block content %}
<div class="layout-two-column">
  <!-- Venstre: indhold -->
  <section class="card card-soft">
    <div class="card-header">
      <div>
        <h1 style="margin:0;">Tidligere vagter</h1>
        <div class="card-subtitle"></div>
      </div>
    </div>

    <p style="margin-top: 6px;">
      <a href="{{ url_for('mine_vagter') }}" class="btn btn-ghost">‚Üê Tilbage til Mine vagter</a>
    </p>

    <!-- Filter -->
    <div class="card" style="margin-top: 12px;">
      <h2 style="margin:0 0 10px 0;">V√¶lg periode</h2>

      {% set month_names = {
        1:"Januar",2:"Februar",3:"Marts",4:"April",5:"Maj",6:"Juni",
        7:"Juli",8:"August",9:"September",10:"Oktober",11:"November",12:"December"
      } %}

      <form method="get" style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
        <div style="min-width: 180px; flex: 1;">
          <label for="year">√Ör</label>
          <select name="year" id="year">
            {% for y in years %}
              <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
          </select>
        </div>

        <div style="min-width: 220px; flex: 1;">
          <label for="month">M√•ned</label>
          <select name="month" id="month">
            {% for m in range(1, 13) %}
              <option value="{{ m }}" {% if m == month %}selected{% endif %}>
                {{ month_names[m] }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div style="min-width: 120px;">
          <button type="submit" class="btn btn-primary">Vis</button>
        </div>
      </form>
    </div>

    <!-- KPI -->
    <div class="card" style="margin-top: 12px;">
      <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:flex-end;">
        <div>
          <div class="helper-text">I alt denne m√•ned</div>
          <div style="font-size: 26px; font-weight: 800; letter-spacing:-0.02em;">
            {{ "%.2f"|format(total_hours) }} timer
          </div>
          <div class="helper-text">
          </div>
        </div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
        </div>
      </div>
    </div>

    <!-- Liste -->
    {% if not signups %}
      <div class="card" style="margin-top: 12px;">
        <div class="helper-text">Ingen vagter i den valgte m√•ned.</div>
      </div>
    {% else %}

      {% for item in signups %}
        {% set shift = item.shift %}
        {% set missing = (item.work_hours is none) %}
        {% set approved = item.hours_approved_by_admin %}
        {% set paid = item.payroll_paid %}
        {% set final_hours = (item.approved_work_hours if approved and item.approved_work_hours is not none else item.work_hours) %}

        <div class="card" style="margin-top: 12px;">
          <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;">
            <div>
              <div style="font-weight:800; font-size:16px;">
                {{ shift.date|dkdate }}
              </div>
              <div class="helper-text">
                {{ shift.location }}{% if shift.description %} ¬∑ {{ shift.description }}{% endif %}
              </div>
            </div>

            <div style="display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end; align-items:flex-start;">
              {% if missing %}
                <span class="tag-pill" style="border-color: rgba(255,75,75,0.6); background: rgba(255,75,75,0.12); color:#ffb4b4;">
                  Timer mangler ‚õî
                </span>
              {% elif paid %}
                <span class="tag-pill" style="border-color: rgba(58,203,106,0.6); background: rgba(58,203,106,0.12); color:#9ff2b7;">
                  Afregnet ‚úÖ
                </span>
              {% elif approved %}
                <span class="tag-pill" style="border-color: rgba(58,203,106,0.45); background: rgba(58,203,106,0.10); color:#b7ffd0;">
                  Godkendt ‚úîÔ∏è
                </span>
              {% else %}
                <span class="tag-pill" style="border-color: rgba(255,213,105,0.7); background: rgba(255,213,105,0.12); color:#ffe6a6;">
                  Afventer godkendelse üïí
                </span>
              {% endif %}
            </div>
          </div>

          <div style="margin-top: 10px; display:flex; gap:12px; flex-wrap:wrap;">
            <div class="card" style="padding:10px 12px; background: rgba(255,255,255,0.02); flex:1; min-width: 220px;">
              <div class="helper-text">Registreret</div>
              <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:baseline;">
                <div><strong>Start:</strong> {{ item.work_start or "-" }}</div>
                <div><strong>Slut:</strong> {{ item.work_end or "-" }}</div>
                <div><strong>Timer:</strong>
                  {% if missing %}
                    ‚Äî
                  {% else %}
                    {{ "%.2f"|format(item.work_hours) }}
                  {% endif %}
                </div>
              </div>
            </div>

            <div class="card" style="padding:10px 12px; background: rgba(255,255,255,0.02); flex:1; min-width: 220px;">
              <div class="helper-text"> Timetal til l√∏n</div>
              <div style="font-size: 18px; font-weight: 800;">
                {% if missing %}
                  ‚Äî
                {% else %}
                  {{ "%.2f"|format(final_hours) }} timer
                {% endif %}
              </div>

              {% if not missing and approved and item.approved_work_hours is not none and item.work_hours is not none and (item.approved_work_hours != item.work_hours) %}
                <div class="helper-text">
                  (Just. fra {{ "%.2f"|format(item.work_hours) }} ‚Üí {{ "%.2f"|format(item.approved_work_hours) }})
                </div>
              {% endif %}

              {% if paid and item.payroll_paid_at %}
                <div class="helper-text">Afregnet: {{ item.payroll_paid_at }}</div>
              {% endif %}
            </div>
          </div>
        </div>

      {% endfor %}
    {% endif %}
  </section>

  <!-- H√∏jre: hero -->
  <aside class="hero-panel">
    <div class="hero-bg-rotator"></div>
    <div class="hero-panel-inner">
      <div>
        <div class="hero-heading">S√•dan l√¶ses status</div>
        <p class="hero-text">
          <strong>Afventer godkendelse</strong>: timer er registreret, men ikke godkendt endnu.<br>
          <strong>Godkendt</strong>: timetallet er l√•st til l√∏n (kan v√¶re justeret).<br>
          <strong>Afregnet</strong>: vagten er sendt til l√∏n.
        </p>
      </div>

      <div class="hero-badge-row">
      </div>
    </div>
  </aside>
</div>
{% endblock %}
